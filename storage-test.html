<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Storage test page</title>    
</head>
<body>

    <h1>Storage test page</h1>

    <div id="loaded"></div>

    <dl>
        <dt>Result:<dt>
        <dd id="result"></dd>
        <dt>Message:<dt>
        <dd id="message"></dd>
        <dt>Code:<dt>
        <dd id="code"></dd>
        <dt>Received files?<dt>
        <dd id="received"></dd>
    </dt>

    <button onclick="signin();" id="signinButton">Sign in</button>


    <script type="text/javascript">
        // IMPORTANT: must view this page through a local webserver running on port 8000
        // `http-server -p 8000`

        // https://github.com/Rise-Vision/storage-client/blob/master/web/js/config/stage.js
        var ROOT_URL = 'https://storage-dot-rvacore-test.appspot.com/_ah/api';
        var CLIENT_ID = '614513768474.apps.googleusercontent.com';
        var SCOPES = 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile';

        function gapiClientLoad() {
            gapi.client.load( 'storage', 'v0.01', function() {
                if ( gapi.client.storage ) {
                    document.getElementById( 'loaded' ).innerHTML = 'STORAGE API is loaded';
                    gapiAuth( true, getFiles );
                }
            }, ROOT_URL );
        }

        function gapiAuth( mode, authorizeCallback ) {
            gapi.auth.authorize({
                client_id: CLIENT_ID,
                scope: SCOPES,
                immediate: mode
            }, authorizeCallback );
        }

        function getFiles() {
            var parameters = {};
            // find companyID in URL at risevision after logging in
            parameters[ 'companyId' ] = '76ef5f8c-cd7b-4041-bff2-728a81366d12';
            gapi.client.storage.files.get( parameters ).execute(function( resp ) {
            document.getElementById( 'message' ).innerHTML = resp.message;
            document.getElementById( 'result' ).innerHTML = resp.result ? 'true' : 'false';
            document.getElementById( 'code' ).innerHTML =  resp.code;
            document.getElementById( 'received' ).innerHTML = (resp.files) ? 'success' : 'failed';
            });
        }
    
        function signin() {
            gapiAuth( false, function() {
                location.reload();
            });
        }
    </script>
    <script src="//apis.google.com/js/client.js?onload=gapiClientLoad"></script>
</body>
</html>